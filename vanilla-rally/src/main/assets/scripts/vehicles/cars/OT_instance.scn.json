[
  {
    "declare_macro": "create_OT_graphics",
    "content": [
      {"call": "renderable_instance", "literals": {"name": "OT_body$SUFFIX", "node": "car_node$NODE_SUFFIX", "resource": "OT/OT_body$DECIMATE"}},
      {"call": "renderable_instance", "literals": {"name": "OT_glass$SUFFIX", "node": "car_node$NODE_SUFFIX", "resource": "OT/OT_glass$DECIMATE"}},
      {"call": "renderable_instance", "literals": {"name": "OT_interior$SUFFIX", "node": "car_node$NODE_SUFFIX", "resource": "OT/OT_interior$DECIMATE"}},

      {"call": "renderable_instance", "literals": {"name": "wheel$SUFFIX", "node": "wheel_left_front_node_visual$NODE_SUFFIX", "resource": "OT/OT_wheel_front$DECIMATE"}},
      {"call": "renderable_instance", "literals": {"name": "wheel$SUFFIX", "node": "wheel_right_front_node$NODE_SUFFIX", "resource": "OT/OT_wheel_front$DECIMATE"}},
      {"call": "renderable_instance", "literals": {"name": "wheel$SUFFIX", "node": "wheel_left_rear_node_visual$NODE_SUFFIX", "resource": "OT/OT_wheel_rear$DECIMATE"}},
      {"call": "renderable_instance", "literals": {"name": "wheel$SUFFIX", "node": "wheel_right_rear_node$NODE_SUFFIX", "resource": "OT/OT_wheel_rear$DECIMATE"}}
    ]
  },
  {
    "declare_macro": "create_OT_lights",
    "content": [
      {"call": "child_node_instance", "literals": {"type": "dynamic", "parent": "car_node$SUFFIX", "name": "light_left_front$SUFFIX",  "position": [-0.5, 0, -22]}},
      {"call": "child_node_instance", "literals": {"type": "dynamic", "parent": "car_node$SUFFIX", "name": "light_right_front$SUFFIX", "position": [ 0.5, 0, -22]}},
      {"call": "renderable_instance", "literals": {"name": "blob$SUFFIX", "node": "light_left_front$SUFFIX",  "resource": "car_light_beam"}},
      {"call": "renderable_instance", "literals": {"name": "blob$SUFFIX", "node": "light_right_front$SUFFIX", "resource": "car_light_beam"}}
    ]
  },
  {
    "declare_macro": "create_OT_physics",
    "content": [
      {
        "call": "rigid_cuboid",
        "literals": {
          "node": "car_node$SUFFIX",
          "hitboxes": ["OT_hitbox", "OT_tirelines"],
          "mass": "%MASS",
          "size": [1.8, 1.5, 4.5],
          "collidable_mode": "%COLLIDABLE_MODE",
          "name": "OT-$SUFFIX"
        }
      },
      {
        "call": "create_engine",
        "literals": {
          "rigid_body": "car_node$SUFFIX",
          "name": "main",
          "angular_vels": [-6000, -4200, -3000, 0, -1],
          "powers": [20, 200, 200, 20, 20],
          "gear_ratios": [0.75, 1.5, 3, 6, 9, -9],
          "w_clutch": 800,
          "max_dw": 2000,
          "hand_brake_pulled": "%HAND_BRAKE_PULLED",
          "audio": {"name": "car", "p_idle": 90, "p_reference": 400}
        }
      },
      {
        "call": "create_engine",
        "literals": {
          "rigid_body": "car_node$SUFFIX",
          "name": "brakes",
          "angular_vels": [0],
          "powers": [0],
          "gear_ratios": [0],
          "w_clutch": 800,
          "max_dw": 2000,
          "hand_brake_pulled": "%HAND_BRAKE_PULLED"
        }
      },

      {"call": "wheel", "literals": {"rigid_body": "car_node$SUFFIX", "node": "wheel_left_front_node$SUFFIX",  "position": [-0.8, 0, -1.2 ], "radius": 0.45, "engine": "main", "brake_force": 5000, "Ks": 1e4, "Ka": 4e2, "musF": [4e3, 8e3], "musC": [1.1, 0.97], "tire_id": 0}},
      {"call": "wheel", "literals": {"rigid_body": "car_node$SUFFIX", "node": "wheel_right_front_node$SUFFIX", "position": [ 0.8, 0, -1.2 ], "radius": 0.45, "engine": "main", "brake_force": 5000, "Ks": 1e4, "Ka": 4e2, "musF": [4e3, 8e3], "musC": [1.1, 0.97], "tire_id": 1}},
      {"call": "wheel", "literals": {"rigid_body": "car_node$SUFFIX", "node": "wheel_left_rear_node$SUFFIX",   "position": [-0.8, 0,  2.6 ], "radius": 0.45, "engine": "brakes", "brake_force": 5000, "Ks": 1e4, "Ka": 4e2, "musF": [4e3, 8e3], "musC": [1.1, 0.97], "tire_id": 2}},
      {"call": "wheel", "literals": {"rigid_body": "car_node$SUFFIX", "node": "wheel_right_rear_node$SUFFIX",  "position": [ 0.8, 0,  2.6 ], "radius": 0.45, "engine": "brakes", "brake_force": 5000, "Ks": 1e4, "Ka": 4e2, "musF": [4e3, 8e3], "musC": [1.1, 0.97], "tire_id": 3}},

      {
        "call": "create_car_controller",
        "literals": {
          "node": "car_node$SUFFIX",
          "front_tire_ids": [0, 1],
          "max_tire_angle": 30
        }
      }
    ]
  },
  {
    "declare_macro": "create_OT",
    "content": [
      {"call": "child_node_instance", "literals": {"type": "dynamic", "parent": "car_node$SUFFIX", "name": "wheel_left_front_node$SUFFIX", "position": [-0.8, 0, -1.2]}},
      {"call": "child_node_instance", "literals": {"type": "dynamic", "parent": "car_node$SUFFIX", "name": "wheel_right_front_node$SUFFIX", "position": [0.8, 0, -1.2]}},
      {"call": "child_node_instance", "literals": {"type": "dynamic", "parent": "car_node$SUFFIX", "name": "wheel_left_rear_node$SUFFIX", "position": [-0.8, 0, 2.6]}},
      {"call": "child_node_instance", "literals": {"type": "dynamic", "parent": "car_node$SUFFIX", "name": "wheel_right_rear_node$SUFFIX", "position": [0.8, 0, 2.6]}},
  
      {"required": ["IF_WITH_GRAPHICS"], "call": "child_node_instance", "literals": {"type": "dynamic", "parent": "wheel_left_front_node$SUFFIX", "name": "wheel_left_front_node_visual$SUFFIX", "rotation": [0, 180, 0]}},
      {"required": ["IF_WITH_GRAPHICS"], "call": "child_node_instance", "literals": {"type": "dynamic", "parent": "wheel_left_rear_node$SUFFIX", "name": "wheel_left_rear_node_visual$SUFFIX", "rotation": [0, 180, 0]}},
      {"required": ["IF_WITH_GRAPHICS"], "playback": "create_OT_graphics", "literals": {"NODE_SUFFIX": "%SUFFIX", "SUFFIX": "%SUFFIX", "DECIMATE": "%DECIMATE"}},
      {"required": ["IF_WITH_GRAPHICS"], "playback": "create_OT_graphics", "literals": {"NODE_SUFFIX": "%SUFFIX", "SUFFIX": "_d1$SUFFIX", "DECIMATE": "_d1"}},
      {"required": ["IF_WITH_GRAPHICS"], "playback": "create_OT_lights", "literals": {"SUFFIX": "%SUFFIX"}},
  
      {"required": ["IF_WITH_PHYSICS", "IF_STATIC"],  "playback": "create_OT_physics", "literals": {"IF_RACING": "%IF_RACING", "IF_RALLY": "%IF_RALLY", "SUFFIX": "%SUFFIX", "MASS": "inf", "COLLIDABLE_MODE": "small_static", "HAND_BRAKE_PULLED": "%HAND_BRAKE_PULLED"}},
      {"required": ["IF_WITH_PHYSICS", "IF_DYNAMIC"], "playback": "create_OT_physics", "literals": {"IF_RACING": "%IF_RACING", "IF_RALLY": "%IF_RALLY", "SUFFIX": "%SUFFIX", "MASS": 1200,  "COLLIDABLE_MODE": "small_moving", "HAND_BRAKE_PULLED": "%HAND_BRAKE_PULLED"}}
    ]
  },
  {
    "declare_macro": "create_player_car_externals_OT",
    "content": [
      {
        "required": ["IF_PC"],
        "playback": "create_car_key_bindings",
        "literals": {
          "IF_RACING": "%IF_RACING",
          "IF_RALLY": "%IF_RALLY",
          "IF_MANUAL_DRIVE": "%IF_MANUAL_DRIVE",
          "IF_MANUAL_AIM": false,
          "IF_HAS_GUN": false,
          "SUFFIX": "%SUFFIX",
          "PLAYER_NAME": "%PLAYER_NAME",
          "ROLE": "driver"
        }
      },
      {
        "required": ["IF_PC"],
        "playback": "create_car_cameras_truck",
        "literals": {
          "SUFFIX": "%SUFFIX",
          "PLAYER_NAME": "%PLAYER_NAME",
          "COCKPIT_CAMERA_POSITION": [-0.4, 1.5, -0.1]
        }
      },
      {
        "call": "player_set_vehicle_control_parameters",
        "literals": {
          "player": "%PLAYER_NAME",
          "surface_power_forward": "inf",
          "surface_power_backward": "-inf",
          "max_tire_angle": 30,
          "tire_angle_pid": {"pid": [1, 1, 0], "alpha": 0.2}
        }
      }
    ]
  },
  {
    "declare_macro": "add_attached_light_OT",
    "content": [
      {
        "playback": "add_attached_light_sedan",
        "literals": {
          "LSUFFIX": "%LSUFFIX",
          "CSUFFIX": "%CSUFFIX"
        }
      }
    ]
  }
]
